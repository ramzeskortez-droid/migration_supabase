# Bugs Log & Solutions

В этом файле фиксируются сложные технические проблемы, с которыми мы столкнулись, и найденные решения.

---

## 1. Ошибка AI: 403 Forbidden / Timeouts (Январь 2026)

### Симптомы
- При нажатии "Распознать" крутится спиннер, затем ошибка 500 или 403.
- Логи Edge Function показывали `wall clock duration warning` (таймаут).
- При попытке использовать прокси — 403 Forbidden от Groq.

### Причины
1.  **Таймауты:** Модель Llama-70b слишком тяжелая для Edge Runtime (лимит времени).
2.  **Блокировка:** API Key от Groq был скомпрометирован или заблокирован (возможно, из-за частых запросов с одного IP).
3.  **Proxy:** Некоторые библиотеки (`fetch` в старом Node.js) некорректно работали с `https-proxy-agent`.

### Решение
1.  **Смена модели:** Перешли на `llama-3.1-8b-instant`. Она отвечает за 1-2 секунды, что укладывается в лимиты Edge Runtime.
2.  **Смена ключа:** Выпущен новый API Key для Groq и прописан в `.env` на сервере.
3.  **Prompt Engineering:** Добавлены Few-Shot примеры (Examples) в системный промпт, чтобы модель 8b корректно распознавала артикулы (не разбивала `0007-2557` на части).

---

## 2. Ошибка Storage: Failed to load response data

### Симптомы
- При загрузке файла в админке или приложении — ошибка сети.
- Логи Supabase чистые.

### Причина
В конфигурации сервера (`.env`) параметры `API_EXTERNAL_URL` и `SUPABASE_PUBLIC_URL` указывали на `http://localhost:8000`. Браузер пользователя пытался отправить файл на свой же компьютер.

### Решение
Заменили `localhost` на реальный IP сервера (`http://77.222.53.52:8000`) в файле `.env` и перезапустили Docker.

---

## 3. Ошибка Фронтенда: Запросы шли на старый адрес

### Симптомы
- Кнопка "Распознать" не работала, в консоли чисто (или запросы на localhost).
- В базе данных не создавались задачи.

### Причина
При локальной сборке (`npm run build`) Vite использовал старый `.env` файл, где `VITE_SUPABASE_URL` указывал на облако или localhost.

### Решение
Обновили локальный `.env` на правильный IP сервера и пересобрали проект.