# Bugs Log & Solutions

## 17.01.2026 - Ошибка TypeError (kp_count) на Дашборде Закупщика
**Версия:** 1.18.118
**Проблема:** При открытии дашборда закупщика возникала ошибка `TypeError: Cannot read properties of undefined (reading 'kp_count')`.
**Причина:** SQL-функция `get_buyer_dashboard_stats` возвращала плоский объект с данными, в то время как фронтенд ожидал вложенную структуру `{ personal: {...}, department: {...}, leaders: {...} }`.
**Решение:** Обновлена SQL-функция в базе данных (и файл миграции), чтобы возвращаемый JSON соответствовал интерфейсу `BuyerDashboard`.
**Статус:** Исправлено

## 17.01.2026 - Двойная загрузка файлов и Race Condition в Dropzone
**Версия:** 1.18.116
**Проблема:** 
1. При сбросе файла на позицию он добавлялся и в позицию, и в общие файлы.
2. При сбросе пачки файлов загружался только один.
**Причина:** 
1. Событие `drop` всплывало от дочернего элемента к глобальному контейнеру.
2. Асинхронные обновления стейта в цикле `forEach` перезаписывали друг друга из-за замыкания.
**Решение:** 
1. Добавлен `event.stopPropagation()` в локальные обработчики `onDrop`.
2. Логика загрузки переписана на `await Promise.all()` с единичным обновлением стейта.
**Статус:** Исправлено

## 17.01.2026 - Ошибка 404/400 при утверждении заказа Менеджером
... (остальное без изменений)
