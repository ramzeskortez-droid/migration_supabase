# Описание проекта: Universal Marketplace Platform

## Обзор
**Marketplace Platform** — это SaaS-система для автоматизации B2B-закупок и управления цепочкой поставок между Китаем и РФ. Система трансформирована из узкоспециализированного маркетплейса автозапчастей в универсальную платформу для обработки заявок любых товарных групп.

Основная задача: Устранить хаос в мессенджерах, структурировать взаимодействие между **Оператором** (ввод заявок), **Закупщиком** (поиск и подача предложений) и **Менеджером** (ценообразование и контроль).

## Технологический стек
- **Frontend:** React 18, TypeScript, Vite.
- **UI Kit:** Tailwind CSS, Lucide Icons.
- **State Management:** React Query (TanStack Query) v5 — активное использование кеширования и инвалидации для мгновенного отклика UI.
- **Database & Backend:** Self-Hosted Supabase (PostgreSQL) на собственном VPS.
  - **Server IP:** `77.222.53.52`
  - **Environment:** Docker Compose (Kong, PostgREST, Auth, Storage, Edge Runtime).
- **AI Integration:** Groq API (LLaMA 3.1 8B Instant) — для скоростного парсинга заявок.
  - **Proxy:** Используется HTTP-прокси для обхода региональных блокировок.
- **Performance:** `react-virtuoso` для виртуализации длинных списков заказов.

## Архитектура Ролей
Система построена на строгом разделении доступа (Role-Based Access Control) с физической изоляцией данных:

1.  **Оператор (Operator):**
    *   Фронт-офис системы.
    *   Задача: Быстрый ввод заявок (вручную или через AI), общение с клиентом и закупщиками.
    *   **Изоляция:** Видит *только* свои созданные заявки (фильтрация по `owner_token`).

2.  **Закупщик (Buyer):**
    *   Внешний контрагент (поставщик в Китае).
    *   Задача: Поиск заказов по брендам, подача ценовых предложений (офферов).
    *   **UX Отказа:** Для экономии места и времени, отказ от позиции сворачивает её в компактную строку. Незаполненные позиции могут быть автоматически помечены как "Отказ" при отправке предложения.
    *   **Авторизация:** Вход по токену или регистрация по инвайт-коду.

3.  **Менеджер (Manager, ex-Admin):**
    *   Бэк-офис / Руководитель.
    *   Задача: Управление курсами валют, выбор лучших предложений ("Лидеров"), формирование итогового КП для клиента, контроль статусов.
    *   **Контроль:** Имеет возможность редактировать данные офферов поставщиков (комментарии, ID) и принудительно утверждать сделки.
    *   Видит *все* заказы системы.

## Ключевые особенности
- **AI-ассистент:** Распознавание текста заявки (email, мессенджер) и автоматическое заполнение таблицы позиций и метаданных заказа. Использует Few-Shot Prompting для корректного разбора артикулов.
- **Финансовое ядро:** Централизованное управление курсами (Юань/Доллар/Рубль) и автоматический расчет итоговой цены за единицу товара (Unit Price) с учетом веса и логистики.
- **Система Стикеров:** Персональные цветные метки для закупщиков для организации работы.
- **Реактивность:** Обновление данных в режиме реального времени (polling 5s) для мгновенного отображения новых офферов.

## Deployment & Migrations (Важно!)
- **Legacy Migrations:** Папка `supabase/migrations` в корне проекта является **устаревшей** (Legacy) и не должна использоваться при деплое. Раньше она служила для ручного наката SQL-файлов.
- **Current Process:** Все изменения схемы БД теперь выполняются агентом напрямую через MCP (`execute_sql`, `apply_migration`) или через Supabase Dashboard.
- **Deploy Script:** Скрипт деплоя должен игнорировать этот шаг и заниматься только обновлением Frontend-части (`dist`) и Edge Functions (если применимо).