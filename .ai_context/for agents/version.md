# Version History

## 1.18.142 - UI: WeChat ID Display & Copy Actions
- **Operator Interface:**
  - В развернутый вид карточки (список товаров) добавлено отображение поля **WeChat ID** для выбранных вариантов.
  - Поле отображается справа от комментария (или отдельно, если комментария нет).
  - Добавлена кнопка "Копировать" рядом с WeChat ID.
- **Buyer Interface:**
  - Добавлена кнопка "Копировать" внутри поля ввода WeChat ID (появляется при наличии значения).

БЫЛА ПРОБЛЕМА:
Оператору приходилось открывать админку или просить менеджера посмотреть ID поставщика. Закупщику было неудобно копировать свой же ID для проверки.

КАК РЕШИЛИ:
1. Вывели `supplierSku` в компонент `OperatorOrderItems` с условным рендерингом.
2. Интегрировали `CopyButton` в оба интерфейса.

## 1.18.141 - UI: Favicon
- **Frontend:**
  - Установлен favicon сайта (используется `header-logo.jpg` из шапки).
  - Развертывание новой версии на сервере.

БЫЛА ПРОБЛЕМА:
У сайта отсутствовала иконка вкладки браузера.

КАК РЕШИЛИ:
Добавили `<link rel="icon">` в `index.html`.

## 1.18.140 - Operator: Advanced Deadline Editing & UI Polish
- **Operator Interface:**
  - **Редактирование Срока:** Функционал перенесен внутрь развернутой панели (в блок клиента) для разгрузки заголовка.
  - **Исправление Багов:** Реализована корректная конвертация форматов даты (RU <-> ISO) для инпута. Решена проблема "сброса" значения при сохранении через принудительное обновление списка (callback propagation).
  - **Компактность:** Блок "Информация о клиенте" переверстан на 6-колоночную сетку. Поля (Имя, Телефон, Почта, Адрес, Срок, Тема) выстроены в одну строку на десктопе. Длинные тексты обрезаются (truncate). Полный текст доступен при наведении.

БЫЛА ПРОБЛЕМА:
Редактирование в заголовке было неудобным, формат даты ломался при сохранении, а список не обновлялся мгновенно из-за отсутствия React Query в этом модуле.

КАК РЕШИЛИ:
1. Перенесли логику в OperatorClientInfo.
2. Написали конвертеры дат `toIsoDate` / `toRuDate`.
3. Пробросили метод `loadOrders` через пропсы для гарантированного рефетча.

## 1.18.138 - UX: Advanced "Repeat" & "Edit" Workflow
- **Admin Interface:**
  - **Умный Повтор (Smart Repeat):** Реализован бесшовный флоу: Повтор -> Смена таба на "Новые" -> Скролл вверх -> Авто-раскрытие -> Режим редактирования. 
  - **Реактивность:** Использование `pendingRepeatId` гарантирует активацию режима правки сразу после подгрузки данных из БД, исключая "гонку состояний".
  - **Скролл-фокус:** Внедрен `Virtuoso.scrollToIndex(0)` для мгновенного визуального фокуса на новом заказе.
  - **Редактирование Срока:** Поле "Срок до" (Deadline) теперь доступно для правки (input type="date") в режиме редактирования заказа.
- **API & Logic:**
  - `repeatOrder`: Теперь копирует исходный deadline без изменений. Архивирует оригинал только если он был активен.
  - `updateOrderMetadata`: Добавлена поддержка сохранения поля `deadline`.

БЫЛА ПРОБЛЕМА:
Процесс повторения заказа был прерывистым: менеджеру приходилось вручную переключать табы, искать новый заказ, раскрывать его и нажимать "Изменить". Также отсутствовала возможность править дедлайн.

КАК РЕШИЛИ:
Связали все этапы в единую цепочку через реактивные стейты и добавили UI-контролы для управления датами.

## 1.18.137 - Feature: Targeted Orders Highlighting
- **Buyer Interface:**
  - Реализована строгая логика "Адресных заявок":
    - Если заявка назначена *группе* закупщиков — она видна всем участникам группы (с бейджиком).
    - Если заявка назначена *лично* (одному) закупщику — она выделяется **анимированным изумрудным свечением** (без жесткой рамки) в общем списке.
    - Выделение пропадает, как только закупщик подает первый оффер (статус меняется на "В работе").
  - Скрыта видимость "чужих" приватных заказов (строгая изоляция через API).
- **Admin / Operator Interface:**
  - Добавлена колонка-бейдж "Закупщик(и)" с иконкой и счетчиком назначенных исполнителей. При наведении показывается список имен.
- **Fixes:**
  - Исправлен краш `ReferenceError: offerEditTimeout` в Админке.
  - Исправлена проблема с передачей `buyerId` в список заказов, из-за чего не работало определение "своих" заявок.

БЫЛА ПРОБЛЕМА:
Закупщики не замечали срочные/индивидуальные заявки в общем потоке. Не было визуального разделения между "общим котлом" и "личным поручением".

КАК РЕШИЛИ:
1. Внедрили логику `isExclusiveToMe` на фронтенде.
2. Добавили CSS-анимацию `animate-pulse` + `shadow-emerald` для карточки заказа.
3. Обновили SQL-запрос `getOrders` для корректной фильтрации приватности.

## 1.18.135 - UI: Chat Sidebar Counters & Cleanup
... (история сохранена)
