# Version History

## 1.3.1 - Delivery Logic Fix
- **Client Interface:** Fixed delivery cost calculation logic. Delivery rate is now treated as a *fixed cost per position* (line item), not multiplied by item quantity.

## 1.3.0 - Performance Optimization
- **Admin Interface:** Implemented "Instant Approval" for Orders.
  - Replaced multiple sequential requests with a single RPC call (`approve_order_winners`).
  - Added Optimistic UI: Tab switches immediately, background process handles the data.
- **Database:** Added `approve_order_winners` stored function.
- **Schema:** Enforced existence of `delivery_rate` column in `offer_items`.

## 1.2.3 - Hotfix for Delivery Rate
- **Supabase Service:** Added fallback mechanism for `delivery_rate`. If the column is missing (migration not applied), it falls back to saving cost in `delivery_days` to prevent data loss and UI breakage.

## 1.2.2 - Bug Fixes
- **Admin Interface:**
  - Fixed a bug where Admin Delivery Rate (Cost) was not saving correctly (was overwriting Delivery Days).
  - Ensured "Total Delivery" is correctly calculated and persisted.

## 1.2.1 - Backend Logic Upgrade
- **ID Generation (Server-Side):**
  - Orders now get sequential integer IDs (1, 2, 3...) generated by `getNextId`.
  - Offers get composite IDs `[OrderId]-[Count]` (e.g., 5-1, 5-2).
- **Google Sheets UX:**
  - Implemented `setupValidations` to auto-generate Dropdown lists for Status columns (Admin, Client, Supplier).
  - Statuses are now strictly typed via `STATUS_OPTS_*` constants.

## 1.2.0 - UI/UX Synchronization with Google Script Logic
- **Data Layer (`sheetService.ts`):**
  - Fixed `statusSupplier` mapping (was `statusSeller`).
  - Implemented `deriveWorkflowStatus` to synthesize a unified status from Admin/Client/Supplier columns.
  - Aligned status strings with Google Script logic (e.g., "КП отправлено", "Подтверждение от поставщика").
- **Types (`types.ts`):**
  - Added 'КП отправлено' to `WorkflowStatus` type.
- **UI Improvements (`AdminInterface`, `ClientInterface`):**
  - Implemented dynamic color coding for rows based on status (Green/Red/Yellow/Blue/Gray).
  - Aligned visuals with the backend "Status Matrix".

## 1.1.0 - Initial Production Release
- Complete flow: Client Order -> Supplier Offer -> Admin Approval -> Client Purchase.
- Telegram broadcasting integration.
- Optimistic UI updates.
- Role-based interfaces (Client, Admin, Supplier).

## 1.0.0 - Prototype
- Basic CRUD operations.
- Google Sheets integration.
