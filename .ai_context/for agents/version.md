# Version History

## 1.18.62 - Внедрение DEBUG режима
- **Manager UI:**
  - В "Настройки" (`AdminSettings`) добавлен тумблер "Режим отладки (DEBUG)".
  - Кнопки "Очистить БД" и "Генерация заказов (100/1000)" в шапке теперь скрыты по умолчанию и появляются только при включенном DEBUG.
  - Реализовано хранение настройки в `system_settings` (key: `debug_mode`).
- **Operator UI:**
  - Кнопка "Быстрый тест" (молния) скрыта для обычных пользователей.
  - Кнопка "Эмуляция" (вставка текста email) скрыта для обычных пользователей.
  - Оба элемента появляются автоматически при включении режима отладки менеджером.
- **Service Layer:**
  - `SupabaseService.getSystemSettings` теперь используется для получения глобальных флагов UI.

## 1.18.61 - Индикация непрочитанных в архиве чата
- **Chat UI:** 
  - На кнопки переключения табов "Активные" / "Архив" добавлены яркие анимированные (pulse) бейджи с количеством непрочитанных сообщений.
  - Внедрена параллельная загрузка тредов для обоих табов для обеспечения актуальности счетчиков.
- **Service Layer:** 
  - Создан файл `api/orders/stats.ts` для изоляции логики подсчета.
  - Исправлен баг `markChatAsRead`: теперь Оператор может помечать прочитанными системные сообщения от Менеджера.
- **Bug Fix:** Устранена ошибка "Cannot update a component while rendering" при навигации из чата (вызовы обернуты в `setTimeout`).

## 1.18.59 - Ручная Обработка и Архивы
- **Global:** Замена `status_admin` -> `status_manager` во всей базе и коде.
- **БД:**
  - Добавлено поле `client_delivery_weeks` в `offer_items` (фиксация срока).
  - Добавлено поле `is_manual_processing` в `orders`.
  - Обновлены RPC функции и триггеры.
- **Менеджер:**
  - Внедрен режим "Ручная обработка" (чекбокс + статус).
  - Фиксация срока доставки при выборе поставщика.
  - Таб "Архив" включает Выполненные, Отказы и Аннулированные заказы.
- **Оператор:**
  - Новый таб "Ручная" с функционалом завершения сделки.
  - Кнопка "Завершить обработку" переводит заказ в "Архив".
- **Закупщик:**
  - Кнопка "Отказаться" с модальным окном.
  - Таб "Архив / Отказ" показывает личные отказы и глобальные отмены.

## 1.18.55 - Рефакторинг OperatorOrderRow и Фикс файлов
- **Operator UI:**
  - Компонент `OperatorOrderRow.tsx` разбит на подкомпоненты: `OperatorClientInfo(ИнформацияОКлиенте).tsx` и `OperatorOrderItems(СписокТоваров).tsx`.
  - Внедрен сводный реестр всех файлов заказа в шапке ("Инфо о клиенте").
  - Новая логика отображения файлов в таблице: превью только для 1 картинки, иначе иконка/стопка со счетчиком.
  - Исправлена проблема обрезания тултипов файлов (Z-Index + Overflow).
  - Исправлен баг потери единственного фото при создании заказа оператором.
- **Admin UI:**
  - Исправлено отображение тултипов файлов в `AdminItemsTable.tsx` (больше не прячутся под хедер).

## 1.18.54 - Документация окружения
- **Docs:** Добавлен `project_id` и регион облачного Supabase в `Project Description.md` для работы через MCP.

## 1.18.53 - Улучшение UX: Сортировка по умолчанию
- **Buyer UI:** Установлена сортировка по умолчанию по `ID` (от большего к меньшему). Теперь новые заказы всегда отображаются вверху списка.

## 1.18.52 - Финализация файлов и Внедрение лога багов
- **System:** Внедрено правило ведения `bugs_log.md` для отслеживания инцидентов.
- **Docs:** Создан файл `.ai_context/for agents/bugs_log.md` с описанием решения проблемы с файлами.
- **Buyer UI:** 
  - Исправлено дублирование файлов оператора в форму закупщика.
  - Исправлено передача общих файлов закупщика на сервер (`handleSubmitOffer`).
  - Улучшено отображение файлов оператора (иконка +N).
- **Admin UI:**
  - Переименован блок "Файлы от поставщиков" -> "Файлы от закупщиков".
- **Operator UI:**
  - Исправлена передача массива файлов `itemFiles` при создании заявки.
...
