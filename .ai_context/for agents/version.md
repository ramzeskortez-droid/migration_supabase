# Version History

## 1.18.95 - Финальные правки логики Чатов
- **Chat Routing (Fix):**
  - Исправлена критическая ошибка, когда сообщения от Закупщика в ветке "Оператор" улетали Менеджеру (ADMIN). Теперь `handleSend` корректно определяет получателя на основе выбранного треда.
  - Исправлено имя отправителя для Закупщика: теперь используется реальное имя (`currentUserName`), а не имя треда. Это устранило баг "сообщения от закупщика выглядят как от оператора".
- **Thread Display:**
  - Для Оператора ветка с Менеджером теперь называется "Менеджер" (ранее "OPERATOR").

## 1.18.94 - Разделение веток чата для Закупщика
...

## 1.18.93 - Финальный фикс множественного редактирования
...

## 1.18.92 - Paranoid Verification
- **Update Logic:**
  - В `updateOrderJson` добавлена "Параноидальная проверка": сразу после `update` скрипт делает `select` по тому же ID и выводит в консоль реальное значение из БД.
  - В `saveEditing` добавлена принудительная инвалидация кеша `order-details`, чтобы UI обновлялся мгновенно без F5.

## 1.18.91 - Логирование и Sequential Update
...
- **Debugging:**
  - Добавлено логирование входящих данных в `AdminInterface.tsx` перед сохранением.
  - Добавлено логирование результата каждого обновления в `updateOrderJson`.
- **Logic:**
  - В `updateOrderJson` подтвержден и усилен последовательный режим обновлений с проверкой результата.

## 1.18.90 - Последовательное сохранение позиций
...
- **Data Logic:**
  - В `updateOrderJson` заменен параллельный `Promise.all` на последовательный цикл `for...of`.
  - Это устраняет проблему "гонки" (Race Condition) и блокировок БД, из-за которой при редактировании нескольких товаров сохранялся только первый.

## 1.18.89 - Debugging Manager Edit
...

## 1.18.88 - Hotfix: Buyer Pagination Props
...

## 1.18.87 - Исправление пагинации, сортировки и редактирования
- **Buyer Interface:**
  - Исправлен баг с ограничением в 20 заказов. В список `Virtuoso` добавлен колбэк `endReached`, теперь скролл работает бесконечно.
- **Data Logic:**
  - Полностью переписана логика пагинации (`fetch.ts`). Переход с ID-based курсора на Range-based (Offset). Это решило проблему "сломанной" сортировки, когда при сортировке не по ID следующие страницы не загружались.
  - Исправлена функция `updateOrderJson` (`update.ts`). Вместо опасного удаления и создания позиций заново (что ломало ID и связи с офферами), теперь выполняется точечный `UPDATE` существующих записей. Это починило редактирование заказа Менеджером.

## 1.18.85 - Отображение имени менеджера
...
- **Admin Interface:**
  - В шапке профиля теперь отображается реальное имя администратора (из токена), а не заглушка "Manager".
  - Имя также корректно передается в чат (GlobalChatWindow), что устраняет путаницу в коммуникации при работе нескольких менеджеров.

## 1.18.84 - Строгая валидация ввода телефона
...

## 1.18.83 - Фикс управления инвайтами и телефонами
- **Admin Interface:**
  - В панель "Управление пользователями" добавлена кнопка генерации инвайтов для роли `admin` (Менеджер). Теперь можно приглашать коллег через интерфейс.
- **Registration:**
  - Уточнена валидация телефона: длина строго от 10 до 15 цифр.

## 1.18.82 - Валидация телефона и регистрация Менеджеров
- **RegisterForm:**
  - Внедрена валидация номера телефона (минимум 10 цифр).
  - Разрешена регистрация для роли "Менеджер" (Admin).
- **Auth Service:** Обновлены функции регистрации для поддержки роли `admin`.
- **LoginForm:** Ссылка "Регистрация" теперь отображается для всех ролей.

## 1.18.81 - Восстановление Регистрации
...

## 1.18.80 - Оптимизация StartPage и навигации
- **Performance:**
  - Полностью переписан `StartPage.tsx`: удалены тяжелые анимации фона (blur, mix-blend-mode), которые вызывали фризы GPU.
  - Дизайн страницы входа упрощен до стиля "Clean SaaS" (bg-slate-50, белые карточки без glassmorphism).
- **Architecture:**
  - Внедрен компонент `MainLayout.tsx` для защищенных страниц.
  - Логика рендеринга `Header` перенесена из `App.tsx` в `MainLayout`. Это устранило визуальный баг, когда шапка оставалась видна при выходе из системы ("залипание").
- **Navigation:**
  - В `useOperatorAuth` заменен `window.location.href` на `useNavigate`, что устранило долгую перезагрузку страницы при выходе.

## 1.18.98 - Исправление просмотра заказов в Архиве у оператора
- **Operator Interface:**
  - Разрешено раскрытие позиций в заказах со статусом "Обработано вручную". Теперь оператор видит выбранных лидеров и варианты в архивных заказах.

## 1.18.97 - Чистка интерфейса и стабилизация правил Git
- **Rules:** Добавлен запрет на цепочки команд с `git commit --amend` для стабильности работы агента.
- **UI Clean-up:** Кнопки ручного обновления ("Обновить") удалены из интерфейсов Менеджера и Закупщика как избыточные (данные обновляются автоматически).

## 1.18.96 - Logic Fix: Отказ Закупщика и Табы
- **Buyer Workflow:**
  - Оптимизирован процесс отказа от заказа. Кнопка отправки теперь скрывается при обнулении позиций, исключая случайную отправку пустых офферов.
  - Исправлена фильтрация табов: заказы со статусом оффера "Отказ" теперь уходят в **Архив**, а не висят в "Активных торгах".

## 1.18.95 - Critical Fix: Ложное отображение лидеров в Ручном режиме
...