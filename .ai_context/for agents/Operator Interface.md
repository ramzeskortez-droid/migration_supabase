# Описание Интерфейса: Оператор (`/operator`)

Рабочее место для создания и первичной обработки заявок. Является "фронт-офисом" системы.
Реализовано в компоненте: `components/OperatorInterface.tsx`.

### 1.1. Аутентификация
- **Регистрация:** Теперь требует **Инвайт-код**, полученный у менеджера. Мастер-пароль удален.
- **Модерация:** После регистрации аккаунт ожидает подтверждения менеджера.
- **Демо-вход:** Кнопки "Женя" и "Ваня" для мгновенного входа.

## 2. Центральная панель: Обработка Заявок
Компоненты: `OrderInfoForm`, `PartsList`, `AiAssistant`, `SystemStatusHorizontal`.

### 2.1. Форма заказа (`OrderInfoForm.tsx`)
- **Почта клиента:** Поле с обязательной валидацией на наличие символов `@` и `.`. При неверном формате поле подсвечивается красным, а создание заказа блокируется.
- **Срок до:** Если оператор не указал дату вручную, при создании заказа система автоматически устанавливает дедлайн **+3 дня** от текущей даты.
- **Быстрый тест:** (Только в режиме DEBUG) Кнопка с молнией для автозаполнения формы случайными данными.

### 2.2. Блок "Файлы по заявке" (OrderFilesUpload)
- **Drag&Drop:** Область для перетаскивания файлов (PDF, Excel, Images и др.).
- **Отображение:** Загруженные файлы мгновенно появляются над зоной загрузки в виде строки с гиперссылками (например, `invoce.pdf, spec.xlsx`).
- **Удаление:** До создания заказа любой файл можно удалить из списка нажатием на крестик.
- **Сохранение:** При создании заказа ссылки на файлы сохраняются в БД и становятся доступны для просмотра Менеджеру и Закупщику.

### 2.3. ИИ-Ассистент (`AiAssistant.tsx`)
- **Эмуляция:** (Только в режиме DEBUG) Кнопка для вставки тестового текста письма.
- **Распознавание:** Отправляет текст в Groq API для извлечения структуры.

---

## 3. Правая панель: Почтовый ящик (`EmailWidget.tsx`)
Реализована в виде **сворачиваемого слайдера** (по умолчанию **открыт**).

### 3.1. Блокировка (Email Locking)
- **Механизм:** Предотвращает одновременную работу двух операторов над одним письмом.
- **Взятие в работу:** При нажатии кнопки "В Ассистент" письмо блокируется за текущим оператором.
- **Отображение:**
  - **Для меня:** Показывается кнопка "В работе (Вы)". Можно снять блокировку вручную.
  - **Для других:** Показывается оверлей "ВЗЯТО В РАБОТУ" с иконкой замка. Кнопки действий скрыты.
- **Таймаут:** Блокировка автоматически снимается, если с момента взятия прошло более **60 секунд**.

### 3.2. Действия
- **В Ассистент:** Передает текст письма в AI и "привязывает" ID письма к будущему заказу.
  - **Важно:** Письмо остается в списке "Новых" до момента фактического создания заказа.
- **Архив:** После создания заказа письмо автоматически перемещается в архив. Если письмо привязано к заказу, в архиве отображается яркая плашка **"Заказ №..."**.

---

## 4. Список Заказов (`OperatorOrdersList.tsx`)

### 4.1. Табы и Статусы
- **В обработке:** Новые заказы без офферов.
- **Идут торги (NEW):** Заказы, по которым получено хотя бы одно предложение от закупщика (статус визуально подменяется на синий "Идут торги").
- **Ручная:** Заказы на ручном контроле.
- **КП готово:** Заказы с готовым коммерческим предложением (желтый статус).
- **Архив:** Включает статусы: "Архив", "Аннулирован", "Отказ", "Выполнен", "КП отправлено" (зеленый), "Обработано вручную" (фиолетовый).

### 4.2. Действия в строке
- **Завершить обработку:** (В табе "Ручная") Переводит заказ в статус "Обработано вручную" и перемещает в архив.
- **Отправлено клиенту:** (В табе "КП готово") Переводит заказ в статус "КП отправлено" и перемещает в архив.

### 4.3. Детали Заказа
- **Инфо о клиенте:** Добавлена строка "Почта".
- **Сводный реестр файлов:** В блоке "Инфо о клиенте" (в раскрытом состоянии) отображается полный список всех файлов заказа. Блок по умолчанию **свернут**, раскрывается кнопкой "Посмотреть список файлов".

---

## 5. Глобальный Чат (`GlobalChatWindow.tsx`)
- **Авто-Архивация:** Диалог уходит в архив через 7 дней после **последнего сообщения** или при смене статуса заказа.
- **Удаление:** Кнопка "Корзина" для мгновенного удаления.
- **Уведомления:** Всплывают в углу экрана на 1 секунду.