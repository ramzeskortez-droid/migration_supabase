# Описание Интерфейса: Закупщик (`/buyer`)

Рабочее место внешнего поставщика (Китая) для поиска заказов и подачи ценовых предложений (офферов).
Реализовано в компоненте: `components/BuyerInterface.tsx`.

---

## 1. Аутентификация
Идентификация происходит по уникальному токену. Вход разрешен только после одобрения менеджером (`status='approved'`).

---

## 2. Подача и Редактирование Предложения

### 2.1. Умный Drag-and-Drop
- **Глобальный:** Можно перетащить файлы в любое место развернутого заказа. Они добавятся в "Общие файлы" предложения. При перетаскивании появляется пунктирная рамка и легкий блюр.
- **Локальный:** При наведении файла на конкретную карточку товара появляется оверлей "Добавить в Позицию #X". Файлы прикрепятся именно к этой строке.

### 2.2. Редактирование (Кнопка "Изменить / Дополнить")
Закупщик может изменить уже отправленный оффер (в табах "В торгах" или "Архив / Отказ"), если менеджер еще не утвердил КП.

- **Логика:**
    - Нажатие кнопки переводит карточку в режим редактирования (инпуты разблокируются).
    - В базе данных фиксируется время начала правки (`locked_at`).
    - **Таймаут:** Сессия редактирования длится согласно настройкам (по умолчанию 5 мин).
- **Ограничения:**
    - Кнопка скрывается, если до автоматического закрытия заказа (3 дня с момента создания) осталось меньше времени, чем `Таймаут + 2 минуты`.
    - Если менеджер утвердил КП, пока закупщик правил — сохранение будет заблокировано с уведомлением.

### 2.3. Валидация полей
- **Нейтральный вход:** При открытии заказа все поля выглядят необязательными (звездочек нет, рамки серые).
- **Активация:** Как только закупщик вводит цену (`> 0`) в любую строку, для этой строки включается проверка обязательных полей (Вес, Срок, SKU и др. согласно настройкам Менеджера).

### 2.4. Умный Отказ
- **Логика последней позиции:** Если закупщик последовательно отказывается от всех позиций в заказе, при нажатии на "Отказаться" у последней активной позиции система автоматически вызывает глобальное окно подтверждения отказа от всего заказа. Это предотвращает отправку "пустых" офферов.

---

## 3. Дашборд KPI (`BuyerDashboard.tsx`)
// ... (existing content)

---

## 4. Тулбар и Табы
- **Поиск:** По ID, VIN, имени клиента или авто.
- **Фильтр Брендов:** 
    - **Быстрые теги:** Динамически формируются из брендов, доступных в табе "НОВЫЕ" (за последние 3 дня).
    - **Персистентность:** Выбранные бренды сохраняются в `localStorage` и не сбрасываются при перезагрузке страницы.
- **Система Табов:** Новые, В торгах, Выигранные, Проигранные, Архив / Отказ.
