# Технический глоссарий и ключевые понятия

В этом документе собраны важные программные термины и поля базы данных, объясненные простыми словами.

---

## 1. Инфраструктура (Self-Hosted)

### API_EXTERNAL_URL
- **Используется в:** Конфигурации сервера (`.env`).
- **Означает:** Публичный адрес, по которому мир (и браузер пользователя) видит Supabase.
- **Почему важно:** Если здесь оставить `localhost`, то при попытке загрузить файл (Upload) сервер скажет браузеру: "Загружай на localhost", и загрузка сломается. Должен быть реальный IP (`http://77.222.53.52:8000`).

### Edge Runtime Proxy
- **Используется в:** Функции `process-email`.
- **Означает:** Механизм, позволяющий Deno (на котором работают функции) ходить в интернет через прокси-сервер.
- **Технически:** Используется `Deno.createHttpClient({ proxy: ... })`, так как прямые запросы к AI-провайдерам (Groq) могут блокироваться по гео-признаку.

---

## 2. Идентификаторы и Токены

### owner_id / owner_token
- **Используется в:** Таблице `orders` и интерфейсе **Оператора**.
- **Означает:** Уникальный идентификатор (UUID) оператора, создавшего заказ.
- **Простыми словами:** Это **цифровая подпись**. Система показывает заказ только тому оператору, чей ID совпадает с `owner_id`. Это обеспечивает изоляцию данных между сотрудниками.

### user_token / buyerToken
- **Используется в:** Таблицах `app_users`, `buyer_order_labels` и при входе **Закупщика**.
- **Означает:** Личный секретный ключ закупщика.
- **Простыми словами:** Пароль и идентификатор в одном флаконе. По нему система понимает, какие "стикеры" (метки) показывать закупщику и какие офферы он уже отправил.

---

## 3. Поля Данных и Файлы

### order_files / supplier_files / item_files (Мульти-файлы)
- **Используется в:** Таблицах `orders`, `offers` и `offer_items`.
- **Формат:** JSONB (массив объектов `{name, url, type}`).
- **Простыми словами:** Это **электронная папка с документами**. В отличие от старой системы с одним фото, теперь к заказу или конкретной детали можно прикрепить десяток разных файлов: PDF-инвойсы, Excel-спецификации или пачку фотографий.

### supplier_sku (Название и номер поставщика)
- **Используется в:** Таблице `offer_items` (предложения закупщиков).
- **Означает:** Внутренний код или имя поставщика, у которого закупщик берет товар.
- **Простыми словами:** **"Заметки для себя"**. Закупщик пишет здесь, у кого именно он нашел эту деталь, чтобы менеджер видел источник закупки, а сам закупщик не забыл его при оформлении.

### client_delivery_weeks (Зафиксированный срок)
- **Используется в:** Таблице `offer_items` (у победителей).
- **Означает:** Итоговый срок доставки в неделях, который обещали клиенту.
- **Простыми словами:** **"Замороженный срок"**. Когда менеджер выбирает поставщика, система считает (СрокПоставщика + Настройка) и записывает сюда. Если потом настройки изменятся, этот срок останется прежним.

---

## 4. Бизнес-логика и Статусы

### workflowStatus (Статус процесса)
- **Используется в:** Всех интерфейсах.
- **Простыми словами:** **"Шаг на конвейере"**. Главный двигатель заказа.
- **Технически:** Мапится из полей `status_manager` (ранее `status_admin`) и `status_client`.

### status_manager (Статус Менеджера)
- **Используется в:** Таблице `orders`.
- **Означает:** Основной статус заказа для внутренней команды (Менеджер/Оператор).
- **Значения:** `В обработке`, `Ручная обработка`, `КП готово`, `КП отправлено`, `Выполнен`, `Архив`, `Отказ`, `Аннулирован`.

### is_manual_processing (Флаг ручной обработки)
- **Используется в:** Таблице `orders`.
- **Означает:** Заказ передан оператору для ручного завершения.
- **Эффект:** Все предложения поставщиков считаются "победителями" (вариантами) для оператора.
