# План миграции на Supabase

## Фаза 1: Подготовка и Анализ (✅ Готово)
- [x] Клонирование репозитория и настройка `migration_supabase`.
- [x] Очистка проекта от мусора и реструктуризация папок.
- [x] **Deep Dive:** Анализ работы `UPDATE_GAS.js` и `SheetService.ts`.
- [x] Выявление проблемы: данные хранятся как JSON-строки внутри ячеек таблицы.
- [x] Решение: Проектирование нормализованной схемы БД (Orders -> Items, Offers -> Items).

## Фаза 2: Настройка Supabase (✅ Готово)
- [x] Установка `@supabase/supabase-js`.
- [x] Настройка переменных окружения (`.env` с URL и Anon Key).
- [x] Инициализация клиента: `src/lib/supabaseClient.ts`.
- [x] **Схема БД:** Написание и выполнение `supabase_schema.sql`:
    - Таблицы: `orders`, `order_items`, `offers`, `offer_items`.
    - Настройка связей (Foreign Keys) и индексов.

## Фаза 3: Реализация Сервисного Слоя (✅ Готово)
- [x] Создание `services/supabaseService.ts`.
- [x] Реализация метода `getOrders` с использованием JOIN запросов (замена парсинга JSON).
- [x] Реализация методов записи: `createOrder`, `createOffer`.
- [x] Реализация бизнес-логики:
    - [x] `updateRank` (Выбор победителя).
    - [x] `formCP` (Формирование КП).
    - [x] `confirmPurchase` (Подтверждение покупки).
    - [x] `refuseOrder` (Отказ).

## Фаза 4: Интеграция с Фронтендом (✅ Готово)
- [x] Рефакторинг `ClientInterface.tsx`: замена `SheetService` на `SupabaseService`.
- [x] Рефакторинг `SellerInterface.tsx`: замена `SheetService` на `SupabaseService`.
- [x] Рефакторинг `AdminInterface.tsx`: замена `SheetService` на `SupabaseService`.
- [x] Исправление путей импорта (`../src/lib/supabaseClient`).

## Фаза 5: Тестирование и Отладка (✅ Готово)
- [x] **Smoke Test:** Запуск локального сервера (`START_LOCAL.bat`).
- [x] Проверка создания заказа (Клиент).
- [x] Проверка создания предложения (Поставщик).
- [x] Проверка выбора победителя (Админ).
- [x] Проверка смены статусов.
- [x] **Оптимизация:** Внедрение серверной пагинации и сортировки (Admin, Client, Seller) для поддержки 100k+ записей.
- [x] **Стресс-тест:** Генерация 1000 и 10000 заказов, проверка скорости работы.
- [x] Фикс UI: Восстановление оригинальной верстки поставщика.

## Фаза 6: Деплой
- [ ] Подготовка к Vercel (настройка Environment Variables в дашборде).
- [ ] Финальный пуш в репозиторий.
