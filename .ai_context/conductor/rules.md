# Глобальные правила (System Rules)

**Эти правила являются обязательными к исполнению во всех задачах.**

1. **Язык и Стиль:**
   - Русский язык для всех ответов, комментариев и документации.
   - Стиль общения: Профессиональный, лаконичный.

2. **Безопасность кода:**
   - Не вносить изменений вне контекста текущей задачи.
   - О критических архитектурных изменениях предупреждать заранее.

3. **Технологический стек (Strict):**
   - **Backend:** Supabase (PostgreSQL). Прямое взаимодействие через `supabaseClient.ts`.
   - **State:** React Query v5. Обязательное использование `invalidateQueries` после мутаций.
   - **UI:** Tailwind CSS. Строгое соблюдение текущей цветовой схемы и сетки.

4. **Работа с документацией (КРИТИЧНО):**
   - Папка `for agents` — **основной источник знаний**.
   - **ОБЯЗАННОСТЬ:** При изменении UI (добавление кнопок, полей, изменение верстки или поведения элементов) ты ОБЯЗАН обновить соответствующий файл:
     - `Operator Interface.md`
     - `Buyer Interface.md`
     - `Manager Interface.md`
   - При изменении бизнес-логики или потоков данных обновляй `Interaction and Logic.md`.
   - При появлении новых терминов обновляй `Technical Terms.md`.

5. **Терминология и Роли:**
   - **Менеджер (Manager):** Управление ценами и воронкой.
   - **Закупщик (Buyer):** Подача ценовых предложений (офферов).
   - **Оператор (Operator):** Ввод и первичная обработка заявок.
   - **Order:** Заявка клиента.
   - **Offer:** Предложение от закупщика.

6. **Принципы разработки:**
   - **Изоляция:** Строгая проверка `owner_token` для Оператора.
   - **Валидация:** Проверка брендов по справочнику, санитарная очистка вводимых данных (особенно цен и телефонов).
   - **Real-time:** Обеспечение актуальности данных (через polling или подписки Supabase).

7. **Работа с багами (bugs_log.md):**
   - Ты **ОБЯЗАН** вести файл `.ai_context/for agents/bugs_log.md`.
   - **КОГДА:** После каждого успешного решения проблемы, подтвержденного пользователем (и до финального коммита).
   - **ПРОЦЕСС:** Спроси пользователя: "Могу ли я занести эту проблему и решение в лог багов?".
   - **ФОРМАТ ЗАПИСИ:**
     ```markdown
     ## [Дата] - [Краткое название проблемы]
     **Версия:** [Текущая версия]
     **Проблема:** [Подробное описание со слов пользователя + техническая суть]
     **Причина:** [Почему это произошло: ошибка в коде, логике, БД]
     **Решение:** [Что конкретно сделали: файлы, методы, логика]
     **Статус:** Исправлено (подтверждено пользователем)
     ```

8. **Отчетность и GIT (КРИТИЧНО):**
   - По завершении: краткий список "Что сделано" и блок "Как проверить".
   - Сообщения коммитов (Git) — **только на русском языке**.
   - **ЗАПРЕЩЕНЫ** комиты состоящие только из заголовка. Описание обязательно.
   - **Обязательная структура коммита:**
     1. **Заголовок:** `ВЕРСИЯ [X.X.X] - [Краткое название]`
     2. **Описание:** Детальный перечень изменений (списком).
     3. **Блок "БЫЛА ПРОБЛЕМА":** Четкое описание бага или отсутствующей функции, которую мы решали.
     4. **Блок "КАК РЕШИЛИ":** Техническое описание реализации.
   - *Техническое примечание:* Если консоль не принимает многострочный текст, используй передачу сообщения через файл (`git commit -F msg.txt`). Несоответствие формата считается нарушением правил.