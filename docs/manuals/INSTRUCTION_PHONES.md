
# Инструкция по обновлению Бэкенда (Google Sheets + Apps Script)

Я обнаружил и исправил проблему, из-за которой заказы исчезали, а телефон не сохранялся. Проблема была на стороне фронтенда (не отправлялся телефон) и требовала небольших изменений в структуре таблицы.

## Шаг 1: Обновите Google Таблицу
Скрипт ожидает колонку "Телефон" в строго определенном месте для корректной записи.

1.  Откройте вашу Google Таблицу, лист **MarketData**.
2.  Найдите колонку **F** ("Имя").
3.  Нажмите правой кнопкой мыши на заголовок колонки **F** и выберите "Вставить справа" (или добавьте колонку так, чтобы она стала **G**).
4.  Назовите новую колонку **Телефон** (именно так, с большой буквы, без пробелов).
5.  Итоговый порядок первых колонок должен быть:
    *   A: ID
    *   B: Parent ID
    *   C: Тип
    *   D: Статус
    *   E: VIN
    *   F: Имя
    *   **G: Телефон**  <-- НОВАЯ
    *   H: Сводка
    *   ... далее как было (JSON и т.д.)

## Шаг 2: Обновите Google Apps Script
Я подготовил файл `UPDATE_GAS.js` с полным, проверенным кодом бэкенда.

1.  Откройте редактор скриптов в вашей Google Таблице (Расширения > Apps Script).
2.  Откройте файл `Code.gs` (или как он у вас назван).
3.  Полностью удалите старый код.
4.  Скопируйте код из файла `UPDATE_GAS.js` (он лежит в корне проекта) и вставьте его в редактор Google.
5.  Нажмите **Сохранить** (дискета).
6.  Нажмите **Начать развертывание** -> **Новое развертывание**.
7.  Выберите тип: **Веб-приложение**.
8.  Описание: `Fix Phone Column`.
9.  Запуск от имени: `Меня`.
10. У кого есть доступ: `Все` (Anyone).
11. Нажмите **Начать развертывание**.
12. **ВАЖНО:** Если URL веб-приложения изменился, обновите его в `types.ts` или `.env` (но обычно при обновлении версии URL остается тот же, если выбирать "Управлять развертываниями" -> "Редактировать" -> "Новая версия"). Лучше просто создать новую версию поверх старой, чтобы не менять URL.

## Что исправлено:
1.  **Фронтенд:** Теперь при создании заказа и предложения телефон корректно отправляется на сервер.
2.  **Бэкенд:** Скрипт теперь корректно считывает и записывает телефон в 7-ю колонку (G).
3.  **Логика:** Исчезновение заказов починено, так как теперь при загрузке данных телефон возвращается с сервера, и фильтрация `Имя == Имя && Телефон == Телефон` проходит успешно.
